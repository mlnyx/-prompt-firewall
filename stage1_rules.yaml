# 1. 화이트리스트 (Strict Anchoring 적용)
# 원칙: 문장의 시작(^)과 끝($)을 제한하여 뒤에 공격 구문이 붙는 것을 원천 차단
whitelist:
  #  단순 인사
  - id: W001_GREETING
    pattern: '(?i)^\s*(hello|hi|hey|greetings|안녕|안녕하세요|반가워)\s*[\.!]*\s*$'
    action: allow
    message: "Simple greeting allowed"

  #  단순 작업 요청
  # 기존 W2를 강화: 뒤에 문장이 더 붙으면 매칭 실패 -> S2로 넘어감
  - id: W002_SIMPLE_TASK
    pattern: '(?i)^\s*(summarize|explain|rephrase|translate|요약|설명|번역)\s*(this|it|please|해줘|하세요)?\s*[\.!]*\s*$'
    action: allow
    message: "Simple task request allowed (No payload)"

  #  짧은 정의 요청 (5단어/30자 이내 제한)
  # 기존 W1을 강화: 문장이 길어지면 Injection 의심 -> S2로 넘어감
  - id: W003_SHORT_DEFINITION
    pattern: '(?i)^\s*(what|who)\s+(is|are)\s+[a-zA-Z0-9\u3131-\uD79D\s]{1,30}\??\s*$'
    action: allow
    message: "Short definition question allowed"

blacklist:
  - id: R1
    name: \"Ignore Prior Instructions\"
    pattern: '(?i)(?:\b(?:ignore|disregard|forget|ignora|brush\s+aside|disavow|break|turn\s+a\s+blind\s+eye|pay\s+no\s+attention|cast\s+aside)\b.*\b(?:instructions?|directives?|guidelines?|rules?|polic(?:y|ies)|boundaries|principles|habits?|narrative|mainstream|bonds?|restrictions?)\b|\b(?:rebegin|start\s+afresh)\b.*\b(?:ignoring|ignore)\b)'
    action: block
    message: \"Attempt to override prior instructions.\"
  - id: R2
    name: \"Developer Mode or DAN Activation\"
    pattern: '(?i)\b(?:developer\s*mode|dev\s*mode|DAN\b|do\s*anything\s*now|jailbreak|unrestricted\s*mode|initiate\s+protocol\s+override)\b'
    action: block
    message: \"Attempt to enable an unrestricted or developer mode.\"
  - id: R3
    name: \"Bypass or Disable Safety Filters\"
    pattern: '(?i)(?:\b(?:bypass|disable|override|skip|reconsider|pass\s+by)\b.*\b(?:safety|safeguards?|security|protections?|moderation|guardrails|censorship|content\s*filter|safe\s*mode|polic(?:y|ies)|guidelines?|rules?|protocols?|constraints?|concerns?)\b|\b(?:unfiltered|uncensored)\b|\bno\s+(?:safety|guardrails|censorship|restrictions|rules|guidelines)\b|\b(?:bypass_safety)\b)'
    action: block
    message: \"Attempt to bypass safety restrictions.\"
  - id: R4
    name: \"Unconstrained Role-Play\"
    pattern: '(?i)\b(?:act as|pretend to be|roleplay as)\b.*\b(?:without (?:rules|limits|restrictions)|no (?:rules|guidelines))\b'
    action: block
    message: \"Attempt to role-play without restrictions.\"
  - id: R5
    name: \"Reveal Hidden Instructions\"
    pattern: '(?i)(?:\b(?:reveal|show|expose|provide|divulge|disclose|unveil|whisper|list|tell\s+me\s+about|output|describe)\b.*\b(?:secret|hidden|internal|undisclosed|previous|initial|concealed|furtive|veiled|hush-hush|banned|clandestine|guarded|withheld|unavailable|offstage|zipped\s+away|banned)\b.*\b(?:instructions?|directives?|rules?|prompts?|messages?|guidelines?|polic(?:y|ies)|biases?|truths?|secrets?|documents?|vulnerabilities|protocols?|biases|source\s+code|coding|training\s+data|design\s+secrets)\b|\b(?:reveal_secret_info|exposesecrets)\b|\b(?:never\s+made\s+public|not\s+intended\s+for\s+user\s+access)\b|\bprevious\s+instructions?\b)'
    action: block
    message: \"Attempt to reveal hidden or previous instructions.\"
  - id: R6
    name: \"Role Impersonation Format\"
    pattern: '(?i)(?:\b(?:system|assistant|user)\s*:\b)'
    action: block
    message: \"Attempt to impersonate a system/user role or define malicious code context.\"
  - id: R7_FULL_CONTENT
    name: Escalate full content request
    pattern: '(?i)\b(?:(?:show|display|provide|print|give|output)\b.*\b(?:(?:entire|full|whole|complete|original)\b.*\b(?:text|content|document|article|email|message)|verbatim|raw\s+text|raw\s+content|exactly\s+as)|no\s+summary|verbatim)\b'
    action: escalate
    message: "Full content output request detected; escalating to Stage 2."

  - id: R8_FILTER_BYPASS
    name: Block safety bypass
    pattern: '(?i)\b(?:(?:bypass|circumvent|override|evade|ignore|disable|turn\s*off|deactivate|remove|eliminate)\b.*\b(?:firewall|safeguards?|safety|security\s*(?:measure|measures|system|protocol|feature)|protections?|moderation|guardrails|censorship|restrictions|limitations|policies|policy|content\s*filter|safe\s*mode)|jailbreak|dev\s*mode|developer\s*mode|DAN\s*mode)\b'
    action: block
    message: "Potential prompt injection: security filter bypass attempt detected."

  - id: R9_DANGEROUS_CODE
    name: Block dangerous code
    pattern: '(?i)\b(?:(?:os\.system\(|subprocess|rm\s*-\s*rf|exec\(|bash\s*-i|shutdown\s*/s|fork\s*bomb|format\s+[A-Z]:|del\s+/?\*?\.*\*))'
    action: block
    message: "Potential prompt injection: dangerous code execution detected."

  - id: R10_EXCESSIVE_CONTENT
    name: Escalate excessive code/links
    pattern: '(?s)(?:```.*?```.*?```|(?:(?:https?://)\S+\s*){3,})'
    action: escalate
    message: "Excessive code/links detected; escalating to Stage 2."

  - id: R11_CONCEAL
    name: Block content concealment
    pattern: '(?i)\b(?:(?:conceal|hide)\b.*\b(?:request|instructions?|prompt|content|filter|moderation|guardrails?)|(?:ensure|ensuring)\b.*\bremains\s*(?:hidden|secret)|keep\s+(?:it|this|everything|the\s+(?:request|content|filter))\s*(?:hidden|secret)|without\s*revealing|(?:(?:do\s*not|don''t)\s*reveal))\b'
    action: block
    message: "Potential prompt injection: content concealment attempt detected."

  - id: R12
    name: \"Simulated Q&A Injection\"
    pattern: '(?i)(?:\#\s*query:|\#\s*answer:|\b(?:exploitvulnerabilities|reveal_secret_info|rebegin|do_not_follow)\s*\()'
    action: block
    message: \"Attempt to inject malicious Q&A format or code execution payload.\"
